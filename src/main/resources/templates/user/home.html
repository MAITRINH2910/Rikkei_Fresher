<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<th:block th:replace="layouts/main_layout :: layout"></th:block>

<body onload="startTime()">
<!-- topbar starts -->
<div class="navbar navbar-default" role="navigation">

    <div class="navbar-inner">
        <a class="navbar-brand" th:href="@{/}"> <img alt="Charisma Logo" src="img/logo10.png"/>
            <span class="hidden-xs"></span></a>
        <div class="search_form" style="float: left">
            <form th:action="@{/search-city}" method="get">
                <input type="text" class="form-control" name="cityName" placeholder="Search Location"
                       style="text-align: left">
                <div class="input-group-append" style="text-align: right">
                    <button class="btn btn-secondary" type="submit"
                            style="margin-top: -70px; background-color: #ffffff00;">
                        <i class="glyphicon glyphicon-search"></i>
                    </button>
                </div>
            </form>
        </div>

        <!-- user dropdown starts -->
        <div class="btn-group pull-right">
            <button class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                <i class="glyphicon glyphicon-user"
                   th:if="${#authorization.expression('hasRole(''ROLE_ADMIN'')')}"><span
                        class="hidden-sm hidden-xs"
                >Admin</span></i>
                <i class="glyphicon glyphicon-user"
                   th:if="${#authorization.expression('hasRole(''ROLE_USER'')')}"><span class="hidden-sm hidden-xs"
                > User</span></i>
                <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
                <li class="nav-item"
                    th:if="${#authorization.expression('hasRole(''ROLE_USER'')') && #authorization.expression('hasRole(''ROLE_ADMIN'')')}">
                    <a th:href="@{/admin}">Your Profile</a>
                </li>
                <li class="nav-item" th:if="${#authorization.expression('hasRole(''ROLE_ADMIN'')')}">
                    <a th:href="@{/admin}">Management</a>
                </li>
                <li class="divider"></li>
                <li><a th:href="@{/logout}">Log-out</a></li>
            </ul>
        </div>
    </div>
</div>
<!-- topbar ends -->
<div class="ch-container">
    <div class="row">
        <!-- left menu starts -->
        <br>
        <div class="col-sm-1 col-lg-1"></div>
        <div class="col-sm-5 col-lg-5">
            <div class="nav-canvas">
                <div class="nav-sm nav nav-stacked"></div>
                <div class="nav nav-pills nav-stacked main-menu">
                    <!--Not Found City-->
                    <div class="table" th:if="${message != null}">
                        <div class="frame" th:object="${currentWeather}"
                             style="width: 100%; height: 420px; border-width: 1px; border-style: solid;border-radius: 15px;
                 border-color: #d7cece; padding: 20px 16px 24px 16px;">
                            <h3 class="message" th:text="${message}"></h3></div>
                    </div>
                    <!--Current Location Weather-->
                    <div class="main cur_local" th:if="${currentWeather == null && message ==null}">
                        <div class="frame" style="width: 100%; height: 400px; border-width: 1px;
                                    border-style: solid;border-radius: 5px; border-color: #d7cece;
                                    padding: 20px 16px 24px 16px;
background-image: url('../../img/blue_mountains.jpg');background-repeat: no-repeat;
background-size: 100% 411px;
">
<!--                            <div style="background-color: #d3d3d34d; height: 360px">-->
                            <span role="heading">
                                <br><br>
                                    <div class="local"
                                         style="font-size: x-large !important; color: #878787 !important;">
                                        <a th:href="@{/weather-detail/__*{nameCity}__}"><p
                                                th:text="*{nameCity}">
                            </a>
                                    </div>
                                    <div class="dateNow"
                                         style="font-size: medium !important; color: #878787 !important; margin-top: 15px">
                                    <p th:text="*{#calendars.format(date, 'dd-MM-yyyy')}"></p>
                                    </div>
                                    <div class="descript" style="margin-top: 15px"><span><i
                                            th:text="*{description}"></i></span></div>
                                    <div class="action" style="float: right">

                                    </div>
                            </span>
                                <div style="font:16px arial,helvetica,sans-serif;padding:0px 0 0;-webkit-touch-callout:none;-webkit-user-select:none;">
                                    <div class="left_side" style="float: left">
                                        <div class="vk_bk date-time" style="margin-top: 15px">
                                            <div class="dmy">
                                                <div class="date">
                                                    <!-- Date-JavaScript -->
                                                    <script type="text/javascript">
                                                        var mydate = new Date()
                                                        var year = mydate.getYear()
                                                        if (year < 1000)
                                                            year += 1900
                                                        var day = mydate.getDay()
                                                        var month = mydate.getMonth()
                                                        var daym = mydate.getDate()
                                                        if (daym < 10)
                                                            daym = "0" + daym
                                                        var dayarray = new Array("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday")
                                                        var montharray = new Array("January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December")
                                                        document.write("" + dayarray[day] + ", " + montharray[month] + " " + daym + ", " + year + "")
                                                    </script>
                                                    <!-- //Date-JavaScript -->
                                                </div>
                                                <div id="txt"></div>
                                            </div>
                                            <div class="clear"></div>
                                        </div>
                                        <br>

                                        <div class="vk_gy vk_sh wob-dtl"></div>
                                    </div>

                                    <div class="right_side">
                                        <div class="vk_bk sol-tmp" style="float: right">
                                            <span class="wob_t" id="temparature" style="display:inline"></span>
                                        </div>
                                        <div aria-level="3" role="heading">
                                            <div class="vk_bk wob-unit" id="celci"
                                                 style="float:left"><span
                                                    class="wob_t" style="display:inline"
                                                    aria-label="°Celsius"
                                                    aria-disabled="true"
                                                    role="button">°C</span><a class="wob_t" href="#"
                                                                              style="display:none;text-decoration:none"
                                                                              data-lams=""
                                                                              data-metric="true"
                                                                              data-url="/setprefs?fheit=0&amp;sig=0_mbZMdjB5rj8mIQKxwwtGp6YovTA=&amp;prev=https://www.google.com/search%3Fq%3Dweather%26oq%3Dweather%26aqs%3Dchrome..69i57j69i60l5.3792j1j4%26sourceid%3Dchrome%26ie%3DUTF-8"
                                                                              role="button" jsaction="wob.t"
                                                                              data-ved="2ahUKEwjcj4Xan6PlAhXCQN4KHQImBKIQ-lswAHoECAwQAQ"><span
                                                    aria-label="°Celsius">°C</span></a>&nbsp;|&nbsp;<a
                                                    class="wob_t"
                                                    href="#"
                                                    style="display:inline;text-decoration:none;margin-left:-1px"
                                                    data-lams=""
                                                    data-metric="false"
                                                    data-url="/setprefs?fheit=1&amp;sig=0_mbZMdjB5rj8mIQKxwwtGp6YovTA=&amp;prev=https://www.google.com/search%3Fq%3Dweather%26oq%3Dweather%26aqs%3Dchrome..69i57j69i60l5.3792j1j4%26sourceid%3Dchrome%26ie%3DUTF-8"
                                                    role="button"
                                                    jsaction="wob.t"
                                                    data-ved="2ahUKEwjcj4Xan6PlAhXCQN4KHQImBKIQ-1swAHoECAwQAg"><span
                                                    aria-label="°Fahrenheit">°F</span></a> <span
                                                    class="wob_t"
                                                    style="display:none;margin-left:-1px"
                                                    aria-label="°Fahrenheit"
                                                    aria-disabled="true"
                                                    role="button">°F</span>
                                            </div>
                                        </div>
                                        <div id="icon_test" class="test123"></div>
                                        <div id="descript_local"></div>
                                    </div>
                                    <br>
                                    <hr>
                                    <div class="noidung">
                                        <div> Min Temparature: <span id="tempMin_local"></span></div>
                                        <div> Max Temparature: <span id="tempMax_local"></span></div>
                                        <div> Pressure: <span id="pressure_local"></span></div>
                                        <div> Humidity: <span id="humidity_local"></span></div>
                                        <div> Wind: <span id="wind_local"></span></div>
                                    </div>
                                </div>
<!--                            </div>-->
                        </div>
                        <div style="clear:both"></div>
                    </div>
                    <!--Search Weather-->
                    <div class="main search_wea" th:if="${currentWeather != null}">
                        <div class="frame" th:object="${currentWeather}" style="width: 100%; height: 400px; border-width: 1px; border-style: solid;border-radius: 5px; border-color: #d7cece;
    padding: 20px 16px 24px 16px;
" ;>
                <span role="heading">
                    <br><br>
                        <div class="local" style="font-size: x-large !important; color: #878787 !important;">
                    <a th:href="@{/weather-detail/__*{nameCity}__}"><p
                            th:text="*{nameCity}" th:value="${param.cityName}">
                            </a>
                    </div>
                        <div class="dateNow"
                             style="font-size: medium !important; color: #878787 !important; margin-top: 15px">
                           <p th:text="*{#calendars.format(date, 'dd-MM-yyyy')}"></p>
                        </div>
                    <div class="descript" style="margin-top: 15px"><span><i th:text="*{description}"></i></span></div>
                    <div class="action" style="float: right" th:switch="${status}">
                                    <a class="btn btn-primary" th:case="'add'"
                                       th:href="@{/save-weather/__*{nameCity}__}"
                                       style="margin-top: -275px">Add</a>
                                    <a class="btn btn-warning" th:case="'update'"
                                       th:href="@{/update-weather/__*{nameCity}__}"
                                       style="margin-top: -275px">Update</a>
                    </div>
                </span>
                            <div id="wob_d"
                                 style="font:16px arial,helvetica,sans-serif;padding:40px 0 0;-webkit-touch-callout:none;-webkit-user-select:none;">
                                <div>
                                    <img th:src="'http://openweathermap.org/img/w/'+*{icon}+'.png'"
                                         width="50"
                                         height="50" style="float:left;height:64px;width:64px">

                                    <div aria-level="3" role="heading" style="padding-left:10px;float:left">
                                        <div>
                                            <div class="vk_bk sol-tmp"
                                                 style="float:left;margin-top:-3px;font-size:50px">
                                    <span class="wob_t" id="wob_tm" style="display:inline"
                                          th:text="*{temp}"></span>
                                                <span class="wob_t" id="wob_ttm"
                                                      style="display:none">82</span>
                                            </div>
                                            <div class="vk_bk wob-unit"
                                                 style="float:left;font-size:16px;margin-top:6px"><span
                                                    class="wob_t" style="display:inline"
                                                    aria-label="°Celsius"
                                                    aria-disabled="true"
                                                    role="button">°C</span><a class="wob_t" href="#"
                                                                              style="display:none;text-decoration:none"
                                                                              data-lams=""
                                                                              data-metric="true"
                                                                              data-url="/setprefs?fheit=0&amp;sig=0_mbZMdjB5rj8mIQKxwwtGp6YovTA=&amp;prev=https://www.google.com/search%3Fq%3Dweather%26oq%3Dweather%26aqs%3Dchrome..69i57j69i60l5.3792j1j4%26sourceid%3Dchrome%26ie%3DUTF-8"
                                                                              role="button" jsaction="wob.t"
                                                                              data-ved="2ahUKEwjcj4Xan6PlAhXCQN4KHQImBKIQ-lswAHoECAwQAQ"><span
                                                    aria-label="°Celsius">°C</span></a>&nbsp;|&nbsp;<a
                                                    class="wob_t"
                                                    href="#"
                                                    style="display:inline;text-decoration:none;margin-left:-1px"
                                                    data-lams=""
                                                    data-metric="false"
                                                    data-url="/setprefs?fheit=1&amp;sig=0_mbZMdjB5rj8mIQKxwwtGp6YovTA=&amp;prev=https://www.google.com/search%3Fq%3Dweather%26oq%3Dweather%26aqs%3Dchrome..69i57j69i60l5.3792j1j4%26sourceid%3Dchrome%26ie%3DUTF-8"
                                                    role="button"
                                                    jsaction="wob.t"
                                                    data-ved="2ahUKEwjcj4Xan6PlAhXCQN4KHQImBKIQ-1swAHoECAwQAg"><span
                                                    aria-label="°Fahrenheit">°F</span></a> <span
                                                    class="wob_t"
                                                    style="display:none;margin-left:-1px"
                                                    aria-label="°Fahrenheit"
                                                    aria-disabled="true"
                                                    role="button">°F</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="vk_gy vk_sh wob-dtl">
                                        <div>Pressure: <span id="wob_pp" th:text="*{pressure}+' hpa'"></span>
                                        </div>
                                        <div>Humidity: <span id="wob_hm" th:text="*{humidity}+' %'"></span>
                                        </div>
                                        <div>Wind: <span><span class="wob_t" id="wob_ws"
                                                               th:text="*{wind}+' m/s'"></span></span>
                                        </div>

                                    </div>

                                </div>

                            </div>
                            <div style="clear:both"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- left menu ends -->

        <!-- right page starts-->
        <!-- History Weather-->
        <div id="content" class="col-lg-6 col-sm-6">
            <div class="row">
                <div class="box col-md-12" th:if="${listCities != null}">
                    <div class="box-inner chung">
                        <div class="box-header well" data-original-title="">
                            <h2><i class="glyphicon glyphicon-folder-close"></i> History Weather</h2>
                        </div>
                        <div class="cover" style="overflow: auto; height: 363px">
                            <div class="cityList" th:each="weather1,i : ${listCities}"
                                 th:attr="weather=${weather1.getNameCity()}">
                                <table class="table table-striped">
                                    <th:block class="listCities" th:each="ci : ${weatherList0.get(i.index)}"
                                              th:attr="wtest=${ci.getNameCity()}">
                                        <th:block th:each="w : ${ci}">
                                            <tr class="detailDB" th:object="${w}"
                                                th:attr="city=${weather1.getNameCity()}">
                                                <td class="icon_rps">
                                                    <img th:src="*{icon}" class="icon">
                                                </td>
                                                <td class="city_rps">
                                                    <!--                                                        <div class="city-date">-->
                                                    <b><a th:href="@{/weather-detail/__*{nameCity}__}">
                                                        <p class="nameCity"
                                                           th:text="*{nameCity}"></p>
                                                    </a></b>
                                                    <p th:text="*{#dates.format(date, 'dd-MM-yyyy')}"
                                                       style="color: black"></p>
                                                    <!--                                                        </div>-->
                                                </td>
                                                <td class="temp_rps">
                                                    <!--                                                        <div class="property">-->
                                                    <div class="badge badge-info"
                                                         th:text="*{temp}+'°С'"></div>
                                                    <b><i id="descript_rps" th:text="*{description}"
                                                          style="color: black"></i></b>
                                                    <p style="color: black" class="general_rps"
                                                       th:text="*{wind}+'m/s &nbsp;  '+ *{humidity}+'% &nbsp; '+*{pressure}+'hpa. '">
                                                        <!--                                                        </div>-->
                                                </td>
                                                <td><a class="text-info"
                                                       th:href="@{/delete-weather/__*{weatherId}__}"
                                                       onclick="return confirm('Do you want to delete this record?')"
                                                       title="Delete Weather">
                                                    <i class="glyphicon glyphicon-minus-sign"
                                                       style="color: red"></i>
                                                </a></td>
                                            </tr>
                                        </th:block>
                                    </th:block>
                                </table>
                                <div class="show-more" th:if="${weatherList0.get(i.index).size() > 1}"
                                     th:attr="show=${weather1.getNameCity()}"
                                     style="font-size: 15px; text-align: center; background: #c6c6db61;color:#317eac;margin-top: -10px; margin-bottom: 5px ">
                                    <b>Show more</b>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--/span-->
            </div><!--/row-->
            <!-- content ends -->
        </div>
        <!-- right page ends-->
    </div><!--/fluid-row-->
</div><!--/.fluid-container-->
<script>
    if ($('.cityList').length > 1) {
        $('tr[city]:visible').each(function () {
            var city = $(this).attr('city');
            $(this).nextAll('tr[city="' + city + '"]').hide();
        });
    }
    $(".show-more").click(function () {
        var cityName = $(this).attr("show");
        console.log(cityName);
        $('[city="' + cityName + '"]:gt(0)').toggle();
        $(this).text() === 'Show less' ? $(this).text('Show more') : $(this).text('Show less');
    });
</script>
</body>
</html>
